# Coresh #

**Сервис для поиска друзей на базе телеграм-бота. Помогает найти единомышленников задавая вопросы сообществу, а так же отвечая на вопросы и оценивая ответы других пользователей.**

Пользователь получает с паузой в сутки набор карточек, который называется спринтом для взаимодействия с сообществом. В едином интерфейсе задаются вопросы, даются ответы на вопросы других юзеров и оцениваются их мысли, что формирует связи для алгоритмов рекомендаций. После прохождения спринта пользователь может посмотреть историю активности лучшего по мнению алгоритма потенциального друга, а так же пользователей для которых он сам стал лучшей парой, если такие есть. При взаимной симпатии - система позволяет обменяться контактами.

Платформа выбирает интересных для пользователя людей с помощью рейтинга соседства. В алгоритме рекомендаций учитывается совместимость по типажу, который определяется на основе опросника пройденного пользоватем после регистрации, лайков мыслей других юзеров, общим подпискам на теги и прочим весам (см. описание алгоритмов ниже). Сервис не учитывает пол, возраст и другие анкетные данные не связанные с качествами личности. Платформа имеет открытый исходный код, средства на содержание и разработку собираются с помощью пожертвований, данные пользователей никак не используются в коммерческих целях.

## Установка ##
_Возможно нужно использовать pip3 вместо pip_

**Установите Python3**
Найдите инструкцию для вашей ОС и установите Python3 для вашей системы, если он ещё не установлен.

**Установите VirtualENV для работы с виртуальным окружением**
```
pip install virtualenv
```
**Войдите в виртуальное окружение**
_из корневой папки проекта_
```
source env/bin/activate
```

**Установите зависимости**
```
pip install -r requirements.txt
```

**Создайте миграции**
_из корневой папки проекта_
```
python manage.py migrate
```

**Запустите локальный сервер**
_из корневой папки проекта_
```
python manage.py runserver
```
## Основные термины ##

**Пользователь** - человек зарегистрированный в системе. Может так же называться участником и юзером.

**Собеседник** - высшая категория для друга и соседа.

**Сосед** - Пользователи, которые автоматически добавляются в список соседей  пользователя в случае совпадения типажа или лайка их карточки. Соседи имеют рейтинг соседства. Пользователи с самым высоким рейтингом соседства после каждого спринта взаимно предлагаются друг-другу стать друзьями. Пользователь может заблокировать соседа, если ему не понравится одна из его карточек, в таком случае, он больше не будет появляться в его спринтах.

**Друг** - если пользователи взаимно добавили друг-друга в друзья - они появляются в соответствующем разделе бота. Друзья могут смотреть ленту активности на платформе друг-друга, а так же им доступны ссылки на их личные аккаунты в Телеграме. Друга можно так же заблокировать.

**Языки** - пользователь должен выбрать свой основной язык, на котором будет отрисовываться интерфейс, а так же языки которыми он владеет. Система автоматически определяет язык карточек и выводит пользователям контент на языках которые он указал как знакомые.

**Спринт** - набор формируемых алгоритмом с паузой раз в сутки персонально для каждого пользователя карточек. При завершении спринта пользователь получает профили одного или нескольких потенциальных друзей.

**Карточка** - базовая сущность, которая является частью спринта. Может быть опросником для формирования личной анкеты (язык, типаж, теги), формой для отправки вопроса сообществу, формой для ответа на вопрос других участников или просьбой оценить ответы на вопросы других пользователей. Во время спринта могут так же показываться информационные карточки, например, с просьбой пожертвовать денег на проект.

**Типаж** - Типажи созданы как один из коэффициентов для алгоритмов рекомендаций. Они не связаны с какими-то интересами или убеждениями пользователей, но помогают находить более комфортных по общему бэкграунду людей, что особенно полезно для новых пользователей. В базе данных ответы на вопросы в "типажах" представлены в виде булевых значений с семантически важным значением NULL. У вопросов могут быть следующие значения: true/NULL/false, true/false, true/NULL. Что бы попасть в соседи пользователя на основе типажа необходимо по всем вопросам попасть либо в полярное значение (true/false) либо в true или false и NULL (то есть, не важно). На основе типажей у новых пользователей формируются соседи, карточки которых будут показываться в приоритетном режиме. Текущий список вопросов для определения типажей см. [здесь](README-files/semantic-list.md).

**Теги** - интересы, жизненные взгляды, темы для обсуждения и прочее. Пользователь должен указать своё отношение к каждому тегу в процессе прохождения спринта. Ответы на теги являются важным весом в формировании спринта. Отношение к тегу имеют три градации: "не интересно" - вопросы по тегу не отображаются, "интересуюсь" - не приоритетный показ карточек, "занимаюсь/поддерживаю/итд" - приоритетный показ карточек и повышенный рейтинг соседства. Текущий набор тегов вы можете увидеть [здесь](README-files/semantic-list.md).

## Пользовательский опыт ##

_Описание экранов и взаимодействий с пользователями_

##### Стартовое окно #####

После запуска бота пользователь может запустить (продолжить) спринт, посмотреть список друзей и настройки. В это стартовое меню можно выйти из любого другого экрана. В случае если ещё не прошли сутки с момента завершения спринта - кнопка "запустить спринт" - не доступна.

##### ожидание спринта #####

Запустив спринт пользователю показывается сообщение о его формировании, в зависимости от загруженности сервиса это может занять какое-то время. После того, как формирование закончится - пользователь будет уведомлен об этом и сможет преступить к прохождению спринта.

##### Вывод спринта #####

0 очередь - Для новых и сброшенный аккаунтов всегда вначале показываются карточки с выбором языков, которыми владеет пользователь и карточки теста на определение типажа что бы с самого начала более-менее рассадить людей "по жанрам". В случае если появятся новые языки или вопросы по определению типажа они добавляются в следующие спринты для всех пользователей.

1 очередь - предложение подписаться на интересные теги. Так как тегов много - ставится лимит на 5 тегов за спринт. Для каждого тега пользователь может указать - интересно/не интересно. Если не интересно - карточки по этому тегу не будут показываться. И если интересно - так же пользователь может указать что он компетентен в этой области. Пользователи компетентные в одной области будут иметь больший приоритет в выводе карточек друг-другу.

2 очередь - предложение задать 1 вопрос сообществу. Пользователь выбирает тег и пишет по нему сообщение. Система автоматически выбирает язык, что бы показывать его только пользователям кто им владеет.

3 очередь - 5 самых релевантных по мнению алгоритмов вопросов, от других пользователей по тегам на которые он подписан, которые будут оценивать другие юзеры. 

4 очередь - 25 ответов на вопросы других юзеров, которые система считает самыми релевантными для оценки пользователем. Их можно лайкнуть, дизлайкнуть, а так же заблокировать и пожаловаться.

5 очередь - информационная карточка добавленная админом, например, с просьбой пожертвовать денег на основном для пользователя языке. Если админ добавил несколько карточек - выбирается случайная.

6 очередь - выводится история вопросов и ответов соседа с самым высоким рейтингом соседства и юзеров для которых пользователь сам стал соседом с самым высоким рейтингом, если они есть. Просмотрев вопросы и ответы каждого потенциального друга, пользователь может предложить дружбу, если это будет взаимно - они добавятся друг-другу в друзья и получат доступ к контактам друг-друга. В дальнейшем карточки вопросов и ответов друзей больше не появляются в спринтах, но пользователь всегда может посмотреть их, зайдя в раздел друзей и выбрав необходимый профиль.

Что бы закончить спринт нужно обязательно обработать все карточки.

##### Список друзей #####

Нажав на кнопку "друзья" в главном меню пользователь видит список профилей.

Выбрав необходимого друга выводится его профиль, где можно узнать его контакты, а так же перейти на его ленту вопросов и ответов. Так же доступна кнопка "удалить из друзей".

В ленте вопросов и ответов отображаются карточки со всей активностью друга. Можно почитать все его вопросы и ответы.  

Нажав на кнопку "удалить из друзей" - пользователю предлагается подтвердить своё желание. Пользователи взаимно больше не будут пересекаться на платформе и иметь доступ к профилям друг-друга. 

##### Профиль #####

В профиле пользователя можно удалить профиль или обнулить его. У обнулённого профиля в любом случае не будут показываться заблокированные собеседники. 

## Алгоритмы ##

_Ниже кратко описаны алгоритмы заложенные в систему_


##### Формирование соседства #####

Каждый пользователь после прохождения теста на типаж получает в соседи всех (**TODO** или, возможно первые 100 найденных), с кем у него совпали ответы на все вопросы, в полярности или нейтрально. Если у пользователей будет хотя бы один противоположный ответ - соседство по типажу не состоится. Для каждого соседа по типажу формируется рейтинг соседства. Происходит проход по каждому вопросу. Те вопросы, у которых ответ в полярности, например, оба юзера предпочитают общаться только на "Вы" - добавляют рейтингу соседства 1 балл, если хотя бы у одного из юзеров на вопрос ответ нейтральный, например, один предпочитает общаться только на "Вы", а другой указал что может подстроиться под собеседника - балл соседству не добавляется. Соседу по типажу новый пользователь так же добавляется в соседи вместе с рейтингом соседства.

##### Формирование спринта #####

Спринт создаётся в несколько итераций и сохраняется в базе данных в таблице "sprints" в формате json. Перед формированием основного спринта проверяется наличие новых языков, вопросов на типаж и тегов. Если есть необработанные карточки с вопросами на эти темы - пользователю добавляются в начало спринта все недостающие вопросы относительно языков и теста на типаж. Вопросам по тегам божет же быть не более 5 за каждый спринт.

1 очередь - добавляется пустая переменная куда пользователь впишет свой вопрос сообществу. Система автоматически определит язык на котором написан вопрос с помощью специального хелпера. 



====================== ДАЛЬШЕ НАБРОСОК И ПОТОК МЫСЛИ ====================== 



2 очередь - система ищет соседа с которым у пользователя самый высокий рейтинг соседства и добавляет его в спринт. Далее он так же ищет и добавляет всех пользователей для которых он является соседом с наивысшим рейтингом. 

4 очередь - 

показывает 5 самых релевантных по мнению алгоритмов вопросов пользователю, которые будут оценивать другие юзеры. Они так же автоматически переводятся. 

5 очередь - 25 ответов на вопросы других юзеров, которые система считает самыми релевантными для оценки пользователем. Их можно лайкнуть, дизлайкнуть, а так же заблокировать и пожаловаться.
**TODO** - сделать 2 сущность для количества карточек одно пользователя в спринте независимо от рейтинга соседства. Задача - что бы пользователь не отправил в бан человека, с которым он категорически не согласен по одном/двум вопросам. 

5 очередь - информационная карточка добавленная админом, например, с просьбой пожертвовать денег. Если админ добавил несколько карточек - выбирается случайная.

6 очередь - выводится история вопросов и ответов соседа с самым высоким рейтингом соседства и юзеров для которых пользователь стал соседом с самым высоким рейтингом, если они есть. Просмотрев вопросы и ответы каждого потенциального друга, пользователь может предложить дружбу, если это будет взаимно - они добавятся друг-другу в друзья и получат доступ к контактам друг-друга. В дальнейшем карточки вопросов и ответов друзей больше не появляются в спринтах, но пользователь всегда может посмотреть их, зайдя в раздел друзей и выбрав необходимый профиль.

- сначала соседи

Обращаемся к полю пользователя в базе "количество спринтов" и если оно равно нулю - включается скрипт формирования

- Последовательность типов карточек (отдельные условия для новых пользователей)
- выбор карточек для показа (для каждого типа)

##### Ранжирование соседей

- добавление в соседство
- операции с рейтингом соседа

##### Ранжирование вопросов

##### Ранжирование ответов

##### Ранжирование тегов

## Дополнительная информация о проекте

- [UML-карта](README-files/uml.md)
- [Семантическая структура](README-files/semantic-list.md)

## Кураторы проекта

- [t.me/grandcore](https://t.me/grandcore)
- [t.me/Mechislav](https://t.me/Mechislav)
