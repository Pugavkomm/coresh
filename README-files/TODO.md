### TODO

**Это служебная информация, её постич может не каждый**

---


#####  #####


##### Шаг 2.10 #####

**I:**

**S:**

**O:**





Хелперы:
- Изменение значения Степ
- Определение языка


В документации:
- Поменять интерес на видимость

Изучить:
- Django - миграции / ORM (sqlite)

Сделать:
- Запись информации о пользователях бота в базу.   
- false, true/false, true/NULL - поменять на микроинт какой-то, который столько же бит занимает вроде. Получается - 1 2 3 или 0 1 2
-  рейтинг вопросов и ответов (конкретных)



##### Вывод спринта #####

0 очередь - Для новых и сброшенный аккаунтов всегда вначале показываются карточки с выбором языков, которыми владеет пользователь и карточки теста на определение типажа что бы с самого начала более-менее рассадить людей "по жанрам". В случае если появятся новые языки или вопросы по определению типажа они добавляются в следующие спринты для всех пользователей.

1 очередь - предложение подписаться на интересные теги. Так как тегов много - ставится лимит на 5 тегов за спринт. Для каждого тега пользователь может указать - интересно/не интересно. Если не интересно - карточки по этому тегу не будут показываться. И если интересно - так же пользователь может указать что он компетентен в этой области. Пользователи компетентные в одной области будут иметь больший приоритет в выводе карточек друг-другу.

2 очередь - предложение задать 1 вопрос сообществу. Пользователь выбирает тег и пишет по нему сообщение. Система автоматически выбирает язык, что бы показывать его только пользователям кто им владеет.

3 очередь - 5 самых релевантных по мнению алгоритмов вопросов, от других пользователей по тегам на которые он подписан, которые будут оценивать другие юзеры. 

4 очередь - 25 ответов на вопросы других юзеров, которые система считает самыми релевантными для оценки пользователем. Их можно лайкнуть, дизлайкнуть, а так же заблокировать и пожаловаться.

5 очередь - информационная карточка добавленная админом, например, с просьбой пожертвовать денег на основном для пользователя языке. Если админ добавил несколько карточек - выбирается случайная.

6 очередь - выводится история вопросов и ответов соседа с самым высоким рейтингом соседства и юзеров для которых пользователь сам стал соседом с самым высоким рейтингом, если они есть. Просмотрев вопросы и ответы каждого потенциального друга, пользователь может предложить дружбу, если это будет взаимно - они добавятся друг-другу в друзья и получат доступ к контактам друг-друга. В дальнейшем карточки вопросов и ответов друзей больше не появляются в спринтах, но пользователь всегда может посмотреть их, зайдя в раздел друзей и выбрав необходимый профиль.

Что бы закончить спринт нужно обязательно обработать все карточки.

##### Список друзей #####

Нажав на кнопку "друзья" в главном меню пользователь видит список профилей.

Выбрав необходимого друга выводится его профиль, где можно узнать его контакты, а так же перейти на его ленту вопросов и ответов. Так же доступна кнопка "удалить из друзей".

В ленте вопросов и ответов отображаются карточки со всей активностью друга. Можно почитать все его вопросы и ответы.  

Нажав на кнопку "удалить из друзей" - пользователю предлагается подтвердить своё желание. Пользователи взаимно больше не будут пересекаться на платформе и иметь доступ к профилям друг-друга. 

##### Профиль #####

В профиле пользователя можно удалить профиль или обнулить его. У обнулённого профиля в любом случае не будут показываться заблокированные собеседники. 


====================== Ниже пока совсем наброски и полёт творческой мысли ====================== 



## Алгоритмы ##

_Ниже кратко описаны алгоритмы заложенные в систему_

Цель алгоритмов сервиса - быстро поместить пользователя в среду с потенциально самыми близкими по духу людьми, дать шанс быстро стать популярными в своей среде интересным юзерам, быстро убирать из общего вывода пользователей, которые не нравятся основной массе сообщества, формируя отдельный мир аутсайдеров внутри платформы.

Система автоматически определит язык карточек с помощью специального хелпера. 

##### Первичный опрос #####

После первого запуска бота или после сброса аккаунта каждый пользователь должен пройти первичный опрос, который определит его первичные рекомендации. С точки зрения дазы данных это точно такой же спринт который хранится в таблице "sprints" в формате json. Создаются карточки, где пользователь должен ответить на вопросы относительно языка интерфейса и языков карточки на которых он хочет видеть. Также проходится опрос, по которому будет определён его типаж, после чего показываются 15 самых популярных тегов, на которые предлагается подписаться пользователю.  

##### Обработка завершенного первого опроса



##### Формирование спринта #####

можно перед каждым спринтом просить пользователя указать смайлик - грустный, весёлый и злой, например и показывать в приоритете тех, кто при прохождении спринта указал такой же


0 очередь - Создаётся новая запись в БД. В начале п роверяется - есть ли теги, на которые система ещё не предложила подписаться пользователю. Если есть - показывается 5 самых популярных ещё не предложенных тегов.    

1 очередь - добавляется пустая переменная, куда пользователь впишет свой вопрос сообществу. 

2 очередь - 5 вопросов на которые должен ответить пользователь. Сначала выводится вопрос и просьба его оценить. Если пользователь выбирает "плохой вопрос", ему показывается следующий вопрос для текущих правил, а карточка получает -1 в свой рейтинг.
- 1 вопрос : самый новый вопрос по тегам пользователя, у которого рейтинг 0 или больше. 
- 1 вопрос : самый популярный по тегам на которые подписан пользователь.
- 3-5 вопрос : по одному самому популярному ещё не отвеченому вопросу от трёх собеседников с самым высоким рейтингом соседства. 
- самый новый вопрос 3-ёх соседей с самым 
-         
- если не набирается 5 вопросов
- Пользователь может нажать "плохой вопрос", тогда е
Шестой вопрос задаётся с вероятностью 10 процентов. В отличии от остальных вопросов - 


выбирается собеседник с самым высоким рейтингом показов (см. ниже) и рейтингом соседства как второй фильтр, выбирается  



 соседства, проверяется какой у него рейтинг показа карточек, если 1 и более - 
с самым высоким рейтингом показов (см. ниже) 


показывает 5 самых релевантных по мнению алгоритмов вопросов пользователю, которые будут оценивать другие юзеры. Они так же автоматически переводятся. 

5 очередь - 25 ответов на вопросы других юзеров, которые система считает самыми релевантными для оценки пользователем. Их можно лайкнуть, дизлайкнуть, а так же заблокировать и пожаловаться.
**TODO** - сделать 2 сущность для количества карточек одно пользователя в спринте независимо от рейтинга соседства. Задача - что бы пользователь не отправил в бан человека, с которым он категорически не согласен по одном/двум вопросам. 

5 очередь - информационная карточка добавленная админом, например, с просьбой пожертвовать денег. Если админ добавил несколько карточек - выбирается случайная.

6 очередь - выводится история вопросов и ответов соседа с самым высоким рейтингом соседства и юзеров для которых пользователь стал соседом с самым высоким рейтингом, если они есть. Просмотрев вопросы и ответы каждого потенциального друга, пользователь может предложить дружбу, если это будет взаимно - они добавятся друг-другу в друзья и получат доступ к контактам друг-друга. В дальнейшем карточки вопросов и ответов друзей больше не появляются в спринтах, но пользователь всегда может посмотреть их, зайдя в раздел друзей и выбрав необходимый профиль.

2 очередь - система ищет соседа с которым у пользователя самый высокий рейтинг соседства и добавляет его в спринт. Далее он так же ищет и добавляет всех пользователей для которых он является соседом с наивысшим рейтингом. 

Обращаемся к полю пользователя в базе "количество спринтов" и если оно равно нулю - включается скрипт формирования

- Последовательность типов карточек (отдельные условия для новых пользователей)
- выбор карточек для показа (для каждого типа)


##### Обработка завершенного спринта

Каждый пользователь после прохождения теста на типаж получает в соседи всех (**TODO** или, возможно первые 100 найденных), с кем у него совпали ответы на все вопросы, в полярности или нейтрально. Если у пользователей будет хотя бы один противоположный ответ - соседство по типажу не состоится. Для каждого соседа по типажу формируется рейтинг соседства. Происходит проход по каждому вопросу. Те вопросы, у которых ответ в полярности, например, оба юзера предпочитают общаться только на "Вы" - добавляют рейтингу соседства 1 балл, если хотя бы у одного из юзеров на вопрос ответ нейтральный, например, один предпочитает общаться только на "Вы", а другой указал что может подстроиться под собеседника - балл соседству не добавляется. Соседу по типажу новый пользователь так же добавляется в соседи вместе с рейтингом соседства.

- рейтинг показа карточек

- рейтинг соседства
- сначала соседи
- Ранжирование вопросов
- Ранжирование ответов
- Ранжирование тегов

